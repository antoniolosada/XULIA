/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.32
 * Generated at: 2013-10-14 16:49:03 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.sql.*;
import javax.naming.*;
import javax.sql.*;

public final class puntuar_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n");
      out.write("   \"http://www.w3.org/TR/html4/loose.dtd\">\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("<html>\n");
      out.write("    <head>\n");
      out.write("        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n");
      out.write("        <title>JSP Page</title>\n");
      out.write("\n");
      out.write("        <script type=\"text/javascript\">\n");
      out.write("            var amarillo_en_codigo = \"#ffff00\";\n");
      out.write("            var verde_en_codigo = \"#9acd32\";\n");
      out.write("            //var verde = \"#adff2f\";\n");
      out.write("            //var amarillo = \"#ffff80\";\n");
      out.write("            var amarillo = \"yellow\";\n");
      out.write("            var verde = \"yellowgreen\";\n");
      out.write("            \n");
      out.write("            var PuestoCambio = 0;\n");
      out.write("            var CambioPuesto = false;\n");
      out.write("            var ImpedirSalida = true;\n");
      out.write("            \n");
      out.write("            function Inicializar()\n");
      out.write("            {\n");
      out.write("                var i;\n");
      out.write("                for (i = 0; i < document.F1.num_dorsales.value; i++)\n");
      out.write("                    {\n");
      out.write("                        //document.getElementById(\"pos\"+i).value = 0;\n");
      out.write("                        eval(\"document.F1.pos\"+i+\".value = 0;\");\n");
      out.write("                    }\n");
      out.write("            window.onbeforeunload = confirmaSalida;  \n");
      out.write("\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            function confirmaSalida()   \n");
      out.write("            {    \n");
      out.write("                if (ImpedirSalida == true)\n");
      out.write("                    return \"Don't leave this page. No salga de esta página.\";\n");
      out.write("            }\n");
      out.write("    \n");
      out.write("            function cambio(p, pos, dorsal)\n");
      out.write("            {\n");
      out.write("                var Puesto = 0;\n");
      out.write("                \n");
      out.write("                if (CambioPuesto == false)\n");
      out.write("                {\n");
      out.write("                    CambioPuesto = true;\n");
      out.write("                    PuestoCambio = 0;\n");
      out.write("                    p.style.backgroundColor = amarillo;\n");
      out.write("                    eval(\"PuestoCambio = document.F1.pos\"+p.id+\".value;\");    \n");
      out.write("                }\n");
      out.write("                else\n");
      out.write("                {\n");
      out.write("                    if (dorsal == 9) //Se ha pulsado la C de nuevo\n");
      out.write("                    {\n");
      out.write("                        CambioPuesto = false;\n");
      out.write("                        PuestoCambio = 0;\n");
      out.write("                        p.style.backgroundColor = verde;\n");
      out.write("                    }\n");
      out.write("                    else\n");
      out.write("                    {\n");
      out.write("                        var i = 0;\n");
      out.write("                        var Posicion = 0;\n");
      out.write("                        var op = 1;\n");
      out.write("                \n");
      out.write("                        eval(\"PuestoCambio = document.F1.pos\"+dorsal+\".value;\");    \n");
      out.write("                \n");
      out.write("                        if (PuestoCambio > 0)\n");
      out.write("                        {\n");
      out.write("                            if (PuestoCambio < pos) \n");
      out.write("                            {\n");
      out.write("                                op = -1;\n");
      out.write("                                PuestoCambio++;\n");
      out.write("                            }\n");
      out.write("                            else\n");
      out.write("                            {\n");
      out.write("                                Posicion = PuestoCambio;\n");
      out.write("                                PuestoCambio = pos;\n");
      out.write("                                pos = Posicion;\n");
      out.write("                                op = 1;\n");
      out.write("                                pos--;\n");
      out.write("                            }\n");
      out.write("\n");
      out.write("                            for (i=0; i< iNumDorsales; i++)\n");
      out.write("                            {\n");
      out.write("                                eval(\"Posicion = document.F1.pos\"+i+\".value;\");\n");
      out.write("                                if (Posicion >= PuestoCambio && Posicion <= pos)\n");
      out.write("                                {\n");
      out.write("                                    eval(\"document.F1.pos\"+i+\".value = Math.abs(Posicion) + op;\");\n");
      out.write("                                    eval(\"document.F2.puesto\"+i+\".value = document.F1.pos\"+i+\".value;\");\n");
      out.write("                                    eval(\"Puesto = document.F1.pos\"+i+\".value;\");\n");
      out.write("                                }\n");
      out.write("                            }\n");
      out.write("                            if (op == 1)\n");
      out.write("                            {\n");
      out.write("                                eval(\"document.F1.pos\"+dorsal+\".value = \"+PuestoCambio+\";\");\n");
      out.write("                                eval(\"document.F2.puesto\"+dorsal+\".value = \"+PuestoCambio+\";\");\n");
      out.write("                            }\n");
      out.write("                            else\n");
      out.write("                            {\n");
      out.write("                                eval(\"document.F1.pos\"+dorsal+\".value = \"+pos+\";\");\n");
      out.write("                                eval(\"document.F2.puesto\"+dorsal+\".value = \"+pos+\";\");\n");
      out.write("                            }\n");
      out.write("                            PuestoCambio = 0;\n");
      out.write("\n");
      out.write("                            CambioPuesto = false;\n");
      out.write("                            ColorearCuadro();\n");
      out.write("                        }\n");
      out.write("                        else\n");
      out.write("                        {\n");
      out.write("                            CambioPuesto = false;\n");
      out.write("                            eval(\"document.F2.c\"+dorsal+\".style.backgroundColor = 'yellowgreen'\");\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("    \n");
      out.write("            function ColorearCuadro()\n");
      out.write("            {\n");
      out.write("                var Puesto;\n");
      out.write("                var i;\n");
      out.write("                var j;\n");
      out.write("                var DorsalesConPuesto = 0;\n");
      out.write("                \n");
      out.write("                //Coloreamos todos de blanco y comprobamos los dorsales con puesto\n");
      out.write("                for (i=0; i< iNumDorsales; i++)\n");
      out.write("                {\n");
      out.write("                    eval(\"Puesto = document.F2.puesto\"+i+\".value;\");\n");
      out.write("                    if (Puesto > 0)\n");
      out.write("                        DorsalesConPuesto++;\n");
      out.write("                    for (j=1; j<= iNumDorsales; j++)\n");
      out.write("                        eval(\"document.F2.p\"+i+\"_\"+j+\".style.backgroundColor = 'white'\");\n");
      out.write("                }\n");
      out.write("\n");
      out.write("                for (i=0; i< iNumDorsales; i++)\n");
      out.write("                {\n");
      out.write("                    eval(\"Puesto = document.F2.puesto\"+i+\".value;\");\n");
      out.write("                    //Coloreamos de verde el puesto y de rojo los demás\n");
      out.write("                    if (Puesto > 0)\n");
      out.write("                    {\n");
      out.write("                        for (j=0; j< iNumDorsales; j++)\n");
      out.write("                        {\n");
      out.write("                            if (j == i)\n");
      out.write("                                eval(\"document.F2.p\"+j+\"_\"+Puesto+\".style.backgroundColor = 'green'\");\n");
      out.write("                            else\n");
      out.write("                                eval(\"document.F2.p\"+j+\"_\"+Puesto+\".style.backgroundColor = 'red'\");\n");
      out.write("                        }\n");
      out.write("                    }    \n");
      out.write("                    eval(\"document.F2.c\"+i+\".style.backgroundColor = 'yellowgreen'\");\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("    \n");
      out.write("            function DorsalNoPresente(d)\n");
      out.write("            {\n");
      out.write("                var PosDorsal;\n");
      out.write("                var PuestoDorsal;\n");
      out.write("                var NoPresente = false;\n");
      out.write("                var Confirmar;\n");
      out.write("                var i;\n");
      out.write("                var salir = false;\n");
      out.write("                var Dorsal;\n");
      out.write("                \n");
      out.write("                PosDorsal = d.id;\n");
      out.write("                \n");
      out.write("                eval(\"NoPresente = document.F2.puesto\"+PosDorsal+\".value;\");\n");
      out.write("                if (NoPresente == 'N')\n");
      out.write("                {\n");
      out.write("                    //Colocar un dorsal no presente como presente\n");
      out.write("                    if (confirm(\"Press 'Accept' if the number is present\"))\n");
      out.write("                    {\n");
      out.write("                        eval(\"document.F2.puesto\"+PosDorsal+\".value = ''\");\n");
      out.write("                        eval(\"document.F1.pos\"+PosDorsal+\".value = '0'\");\n");
      out.write("                        eval(\"document.F2.puesto\"+PosDorsal+\".style.backgroundColor = 'white'\");\n");
      out.write("                        iNumDorsales++;\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("                else //Dorsal presente a no presente\n");
      out.write("                {\n");
      out.write("                    if (confirm(\"Press 'Accept' if the number not this present?\"))\n");
      out.write("                    {\n");
      out.write("                        //Primero comprobamos que ningún dorsal tenga un puesto mayor que el número de dorsales\n");
      out.write("                        for (i=0; i<iNumDorsales; i++)\n");
      out.write("                        {\n");
      out.write("                            eval(\"PuestoDorsal = document.F1.pos\"+i+\".value;\");\n");
      out.write("                            eval(\"Dorsal = document.F1.dorsal\"+i+\".value;\");\n");
      out.write("                            if (PuestoDorsal == iNumDorsales)\n");
      out.write("                            {\n");
      out.write("                                alert(\"The number \"+Dorsal+\" have a bigger position\");\n");
      out.write("                                salir = true;\n");
      out.write("                            }\n");
      out.write("                        }\n");
      out.write("                        if (!salir)\n");
      out.write("                        {\n");
      out.write("                            eval(\"PuestoDorsal = document.F1.pos\"+PosDorsal+\".value;\");\n");
      out.write("                            if (PuestoDorsal > 0 )\n");
      out.write("                                alert(\"The number has assigned a position\");\n");
      out.write("                            else\n");
      out.write("                            {\n");
      out.write("                                eval(\"document.F2.puesto\"+PosDorsal+\".value = 'N'\");\n");
      out.write("                                eval(\"document.F1.pos\"+PosDorsal+\".value = '0'\");\n");
      out.write("                                eval(\"document.F2.puesto\"+PosDorsal+\".style.backgroundColor = 'red'\");\n");
      out.write("                                iNumDorsales--;\n");
      out.write("                            }\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("    \n");
      out.write("            function Recargar()\n");
      out.write("            {\n");
      out.write("                var confirmacion;\n");
      out.write("                \n");
      out.write("                confirmacion = prompt(\"Type 'y' if this operation is authorized\",\"no\")\n");
      out.write("                if (confirmacion == \"y\")\n");
      out.write("                {\n");
      out.write("                    document.F1.op.value=2;\n");
      out.write("                    document.F1.submit();\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("            function Enviar()\n");
      out.write("            {\n");
      out.write("                var i;\n");
      out.write("                var DorsalSinPuesto = false;\n");
      out.write("                var Puesto;\n");
      out.write("                \n");
      out.write("                //Comprobamos que todos los dorsales tienen puesto\n");
      out.write("                for (i = 0; i < iNumDorsales; i++)\n");
      out.write("                    {\n");
      out.write("                        //Puesto = document.getElementById('pos'+i).value;\n");
      out.write("                        eval(\"Puesto = document.F1.pos\"+i+\".value;\");\n");
      out.write("                        if (Puesto == 0)\n");
      out.write("                            {\n");
      out.write("                                eval(\"Puesto = document.F2.puesto\"+i+\".value;\");\n");
      out.write("                                if (Puesto != 'N')\n");
      out.write("                                    DorsalSinPuesto = true;\n");
      out.write("                            }\n");
      out.write("                    }\n");
      out.write("                    if (DorsalSinPuesto)\n");
      out.write("                        alert(\"All the numbers have to have position to send the data\");\n");
      out.write("                    else\n");
      out.write("                    {\n");
      out.write("                        ImpedirSalida = false;\n");
      out.write("                        document.F1.op.value=1;\n");
      out.write("                        document.F1.submit();\n");
      out.write("                    }\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            function EnviarElim()\n");
      out.write("            {\n");
      out.write("                    if (iMarcas > 0)\n");
      out.write("                        alert(\"You have not selected all the numbers\");\n");
      out.write("                    else\n");
      out.write("                    {\n");
      out.write("                        ImpedirSalida = false;\n");
      out.write("                        document.F1.op.value=1;\n");
      out.write("                        document.F1.submit();\n");
      out.write("                    }\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            function pasaElim(c,selec)\n");
      out.write("            {\n");
      out.write("                var dorsal;\n");
      out.write("                var pos_dorsal;\n");
      out.write("                var s;\n");
      out.write("                \n");
      out.write("                dorsal = c.value; //Contiene el número del dorsal\n");
      out.write("                pos_dorsal = c.id; //Contiene la posición del dorsal\n");
      out.write("                \n");
      out.write("                if (c.style.backgroundColor == \"lightgreen\")\n");
      out.write("                {\n");
      out.write("                    c.style.backgroundColor = \"white\";\n");
      out.write("                    iMarcas = iMarcas + 1;\n");
      out.write("                    //document.getElementById('pos'+dorsal).value = 0;\n");
      out.write("                    eval(\"document.F1.pos\"+pos_dorsal+\".value = 0;\");\n");
      out.write("                }\n");
      out.write("                else if (c.style.backgroundColor == \"yellow\")\n");
      out.write("                {\n");
      out.write("                \n");
      out.write("                    if (iMarcas > 0)\n");
      out.write("                    {\n");
      out.write("                        c.style.backgroundColor = \"lightgreen\";\n");
      out.write("                        //document.getElementById(\"pos\"+dorsal).value = 1;\n");
      out.write("                        eval(\"document.F1.pos\"+pos_dorsal+\".value = 1;\");\n");
      out.write("                        iMarcas = iMarcas - 1;\n");
      out.write("                    }\n");
      out.write("                    else alert (\"All the numbers are selected\")\n");
      out.write("                }\n");
      out.write("                else\n");
      out.write("                {\n");
      out.write("                    //c.style.backgroundColor = amarillo_en_codigo;\n");
      out.write("                    c.style.backgroundColor = \"yellow\";\n");
      out.write("                }\n");
      out.write("                    \n");
      out.write("                document.F1.Dorsales.value=iMarcas;\n");
      out.write("            }\n");
      out.write("\n");
      out.write("    \n");
      out.write("        function pasa(c){\n");
      out.write("                var i = 1;\n");
      out.write("                var pos;\n");
      out.write("                var dorsal;\n");
      out.write("                var s;\n");
      out.write("                var asignado;\n");
      out.write("                var PuestoActual;\n");
      out.write("                var PuestoTmp;\n");
      out.write("\n");
      out.write("                s = c.id;\n");
      out.write("                pos = s.charAt(2);\n");
      out.write("                dorsal = s.charAt(0);\n");
      out.write("                \n");
      out.write("                //Si está solicitado un cambio\n");
      out.write("                if (CambioPuesto == true)                \n");
      out.write("                {\n");
      out.write("                    if (pos > iNumDorsales)\n");
      out.write("                    {\n");
      out.write("                        alert(\"The position is very big\");\n");
      out.write("                        asignado = true;\n");
      out.write("                    }\n");
      out.write("                    else cambio(c, pos, dorsal);\n");
      out.write("                }\n");
      out.write("                else\n");
      out.write("                {\n");
      out.write("                    //PuestoActual = document.getElementById(\"puesto\"+dorsal).innerHTML; //Puesto actual\n");
      out.write("                    eval(\"PuestoActual = document.F2.puesto\"+dorsal+\".value;\");\n");
      out.write("                    //Si ya tenía este puesto se lo quitamos\n");
      out.write("                    if (pos == PuestoActual)\n");
      out.write("                        {\n");
      out.write("                            ColorearPuesto(c,dorsal,pos,0);\n");
      out.write("                            asignado = true;\n");
      out.write("                        }\n");
      out.write("                    else \n");
      out.write("                        {\n");
      out.write("                            //Comprobamos si el puesto es mayor que el número de dorsales\n");
      out.write("                            if (pos > iNumDorsales)\n");
      out.write("                            {\n");
      out.write("                                alert(\"The position is very big\");\n");
      out.write("                                asignado = true;\n");
      out.write("                            }\n");
      out.write("                            else\n");
      out.write("                            {\n");
      out.write("                                //Comprobamos si el puesto seleccionado lo tiene otro dorsal\n");
      out.write("                                for (i=0; i<iNumDorsales; i++)\n");
      out.write("                                {\n");
      out.write("                                    //PuestoTmp = document.getElementById(\"puesto\"+i).innerHTML;\n");
      out.write("                                    eval(\"PuestoTmp = document.F2.puesto\"+i+\".value;\");\n");
      out.write("                                    if (pos == PuestoTmp)\n");
      out.write("                                    {\n");
      out.write("                                        asignado = true;\n");
      out.write("                                        if (confirm(\"The position is already assigned.Do you want to change the position?\"))\n");
      out.write("                                        {\n");
      out.write("                                            ColorearPuesto(c,i,pos,0);\n");
      out.write("                                            asignado = false;\n");
      out.write("                                        }\n");
      out.write("                                    }\n");
      out.write("                                }\n");
      out.write("                            }        \n");
      out.write("                        }\n");
      out.write("                    if (!asignado)\n");
      out.write("                        ColorearPuesto(c,dorsal,pos,pos);\n");
      out.write("                }\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            function ColorearPuesto(p, dorsal, pos, puesto)\n");
      out.write("            {\n");
      out.write("                var s;\n");
      out.write("                var PuestoActual;\n");
      out.write("                if (puesto > 0)\n");
      out.write("                    {\n");
      out.write("                    //Si este dorsal tenía otro puesto se lo quitamos\n");
      out.write("                    eval(\"PuestoActual = document.F2.puesto\"+dorsal+\".value;\");\n");
      out.write("                    //PuestoActual = document.getElementById(\"puesto\"+dorsal).innerHTML;\n");
      out.write("                    if (PuestoActual != '')\n");
      out.write("                        {\n");
      out.write("                        ColorearPuesto(p,dorsal,PuestoActual,0);\n");
      out.write("                        }\n");
      out.write("                    \n");
      out.write("                    //document.getElementById(\"puesto\"+dorsal).style.backgroundColor = \"yellow\";\n");
      out.write("                    eval(\"document.F2.puesto\"+dorsal+\".style.backgroundColor = 'yellow';\");\n");
      out.write("                    //document.getElementById(\"puesto\"+dorsal).innerHTML=puesto;\n");
      out.write("                    eval(\"document.F2.puesto\"+dorsal+\".value=puesto;\");\n");
      out.write("                    for (i=0; i<iNumDorsales; i++)\n");
      out.write("                        {\n");
      out.write("                        s = i+\"_\"+pos;\n");
      out.write("                        //document.getElementById(s).style.backgroundColor = \"RED\";\n");
      out.write("                        eval(\"document.F2.p\"+s+\".style.backgroundColor = 'RED';\");\n");
      out.write("                        }\n");
      out.write("                    p.style.backgroundColor = \"green\";\n");
      out.write("                    //document.getElementById(\"pos\"+dorsal).value = puesto;\n");
      out.write("                    eval(\"document.F1.pos\"+dorsal+\".value = puesto;\");\n");
      out.write("                    }\n");
      out.write("                 else //Eliminamos el puesto\n");
      out.write("                    {\n");
      out.write("                    //document.getElementById(\"puesto\"+dorsal).value = 0;\n");
      out.write("                    eval(\"document.F2.puesto\"+dorsal+\".value = 0;\");\n");
      out.write("                    //document.getElementById(\"puesto\"+dorsal).style.backgroundColor = \"white\";\n");
      out.write("                    eval(\"document.F2.puesto\"+dorsal+\".style.backgroundColor = 'white';\");\n");
      out.write("                    //document.getElementById(\"puesto\"+dorsal).innerHTML=\"\";\n");
      out.write("                    eval(\"document.F2.puesto\"+dorsal+\".value='';\");\n");
      out.write("                    //document.getElementById(\"pos\"+dorsal).value = 0;\n");
      out.write("                    eval(\"document.F1.pos\"+dorsal+\".value = 0;\");\n");
      out.write("                    for (i=0; i<iNumDorsales; i++)\n");
      out.write("                        {\n");
      out.write("                        s = \"p\"+i+\"_\"+pos;\n");
      out.write("                        //document.getElementById(s).style.backgroundColor = \"white\";\n");
      out.write("                        eval(\"document.F2.\"+s+\".style.backgroundColor = 'white';\");\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("            }\n");
      out.write("        </script>\n");
      out.write("    </head>\n");
      out.write("    <!------------------------------------------------------------------------------------------------------------------------------------------------------------->\n");
      out.write("    <!------------------------------------------------------------------------------------------------------------------------------------------------------------->\n");
      out.write("    <!------------------------------------------------------------------------------------------------------------------------------------------------------------->\n");
      out.write("    <!------------------------------------------------------------------------------------------------------------------------------------------------------------->\n");
      out.write("    <body onLoad='Inicializar();'>\n");
      out.write("        ");

            try {
                Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
            } catch (Exception e) {
                System.out.println("No se ha podido cargar el Driver JDBC-ODBC");
            }
            try {

                // Obtenemos un contexto inicial
                InitialContext ctx = new InitialContext();

                // Obtenemos el contexto de nuestro entorno. La cadena
                // "java:comp/env" es siempre la misma
                Context envCtx = (Context) ctx.lookup("java:comp/env");

                // Obtenemos una fuente de datos identificada con la cadena que
                // le hemos asignado en los ficheros de configuración
                DataSource ds = (DataSource) envCtx.lookup("jdbc/escrutinio");

                // Ya podemos obtener una conexión y operar con ella normalmente
                Connection con = ds.getConnection();

                //Connection con = DriverManager.getConnection("jdbc:odbc:escrutinio", "", "");
                ResultSetMetaData rsmd;
                Statement st;
                ResultSet rs;
                ResultSet rs1;
                String sJuez = "A";
                String sCategoria = "Empty";
                long lComp = 0;
                long lCateg = 0;
                int  iBaile = 0; 
                int  iFase = 0;
                int  iRep = 0;
                int  iOp = 0;
                int iNumDorsales = 0;
                int iMarcas = 0;
                int iID_PDA = 0;
                String sBaileAbrev = "";
                String sSQL;
                
                    if (request.getParameter("juez") != null)
                        sJuez = request.getParameter("juez");
                    else
                    {
                        out.println("<h2>The judge is not selected</h2>");
                    }
                    if (request.getParameter("op") != null)
                       iOp = (Long.valueOf(request.getParameter("op"))).intValue();
                    else
                       iOp = 0;
                    if (request.getParameter("num_dorsales") != null)
                       iNumDorsales = (Long.valueOf(request.getParameter("num_dorsales"))).intValue();
                    else
                       iNumDorsales = 0;
                    if (request.getParameter("id_pda") != null)
                       iID_PDA = (Long.valueOf(request.getParameter("id_pda"))).intValue();
                    else
                       iID_PDA = 0;

               if (request.getParameter("comp") != null)
                {
                    lComp = (Long.valueOf(request.getParameter("comp"))).longValue();
                    if (request.getParameter("categ") != null)
                        lCateg = (Long.valueOf(request.getParameter("categ"))).longValue();
                    else
                        lCateg = 0;
                    
                    if (request.getParameter("baile") != null)
                        iBaile = (Long.valueOf(request.getParameter("baile"))).intValue();
                    else
                        iBaile = 0;

                    if (request.getParameter("fase") != null)
                        iFase = (Long.valueOf(request.getParameter("fase"))).intValue();
                    else
                        iFase = 0;

                    if (request.getParameter("rep") != null)
                        iRep = (Long.valueOf(request.getParameter("rep"))).intValue();
                    else
                        iRep = 0;
                }
                else
                {
                    //Si no tenemos la categoría, cargamos la actual
                    st = con.createStatement();
                    rs = st.executeQuery("SELECT * FROM cfg_html WHERE fase = 'ACTUAL'");
                    if (rs.next())
                    {
                        lComp = rs.getLong("cod_comp");
                        lCateg = rs.getLong("cod_categoria");
                        iFase = rs.getInt("cod_fase");
                        iBaile = rs.getInt("cod_baile");
                        iRep = rs.getInt("cod_rep");
                    }
                    rs.close();
                    st.close();
                }

                //Grabamos la información del juez
                try
                {
                    st = con.createStatement();
                    if (iID_PDA > 0)
                        st.executeUpdate("DELETE FROM jueces_html WHERE id_pda ="+iID_PDA);
                    sSQL = "INSERT INTO jueces_html VALUES ('"+sJuez+"', " +lCateg+",'"+iID_PDA+"')";
                    st.executeUpdate(sSQL);
                    st.close();
                }
                catch(Exception e)
                {        
                    //Si hay un error por estar ya introducido no hacemos nada
                }
                
                if (iOp == 2) //Cargamos la información de la categoría actual
                {
                    st = con.createStatement();
                    rs = st.executeQuery("SELECT * FROM cfg_html WHERE fase = 'ACTUAL'");
                    if (rs.next())
                    {
                        lComp = rs.getLong("cod_comp");
                        lCateg = rs.getLong("cod_categoria");
                        iFase = rs.getInt("cod_fase");
                        iBaile = rs.getInt("cod_baile");
                        iRep = rs.getInt("cod_rep");
                    }
                    rs.close();
                    st.close();
                }
                if (iOp == 1) //Grabamos los datos y cargamos los siguientes datos
                {
                    int i;
                    int iDorsal = 0, iPuesto = 0;

                    st = con.createStatement();
                    sSQL = "DELETE FROM puntuaciones WHERE cod_juez = '"+sJuez+"' AND cod_categoria ="+lCateg+" AND fase="+iFase+" AND cod_baile="+iBaile+" AND repesca = "+iRep;
                    st.executeUpdate(sSQL);
                    st.close();
                    //Grabamos las puntuaciones de todos los dorsales
                    for (i=0; i<iNumDorsales; i++)
                    {
                        if (request.getParameter("dorsal"+i) != null)
                            iDorsal = (Long.valueOf(request.getParameter("dorsal"+i))).intValue();

                        if (request.getParameter("pos"+i) != null)
                            iPuesto = (Long.valueOf(request.getParameter("pos"+i))).intValue();
                            
                        //Insertamos los datos en la base de datos
                        st = con.createStatement();
                        sSQL = "INSERT INTO puntuaciones VALUES("+iDorsal+","+lCateg+","+iBaile+",'"+sJuez+"',"+iPuesto+","+iFase+","+iRep+")";
                        st.executeUpdate(sSQL);
                        st.close();
                    }
                   //Primero comprobamos si aún queda algún baile en esta fase
                    sSQL = "SELECT TOP 1 cod_baile FROM Bailes_Categ WHERE posicion > (SELECT bc.posicion FROM bailes_categ bc WHERE bc.cod_baile = "+iBaile+" AND bc.cod_categoria = "+lCateg+" AND ((bc.fase ="+iFase+") OR ("+iFase+">2 AND bc.fase = 2))) AND cod_categoria ="+lCateg+" AND ((fase ="+iFase+") OR ("+iFase+">2 AND fase = 2)) ORDER BY posicion";
                    st = con.createStatement();
                    rs = st.executeQuery(sSQL);
                    if (rs.next())
                    {
                        iBaile = rs.getInt("cod_baile");
                    }
                    else
                    {
                        rs.close();
                        //Es el último baile => cargamos la siguiente categoría según el horario
                        /*sSQL = "SELECT TOP 1 * FROM horario WHERE numfase <> 99 AND cod_competicion = " + lComp +
                               " AND orden > (SELECT TOP 1 orden FROM horario WHERE cod_categoria = " + lCateg + " and numfase = " + iFase +
                               " AND repesca = " + iRep + " AND cod_competicion = " + lComp + ") ORDER BY orden";*/
                        sSQL = "SELECT * FROM cfg_html WHERE fase = 'SIGUIENTE' AND cod_comp > 0";
                        rs = st.executeQuery(sSQL);
                        if (rs.next())
                        {
                            lCateg = rs.getLong("cod_categoria");
                            iFase = rs.getInt("cod_fase");
                            iRep = rs.getInt("cod_rep");
                            iBaile = rs.getInt("cod_baile");
                        }
                        else
                            out.println("<h2>This is the last category</h2>");
                           
                    }
                    
                }
    
                //Si el horario no establece baile de comienzo
                if (iBaile == 0)
                {
                    //Recuperamos el primer baile
                    sSQL = "SELECT TOP 1 cod_baile FROM Bailes_Categ WHERE cod_categoria ="+lCateg+" AND (fase ="+iFase+" OR ("+iFase+">2 AND fase = 2)) ORDER BY posicion";
                    st = con.createStatement();
                    rs = st.executeQuery(sSQL);
                    if (rs.next())
                        iBaile = rs.getInt("cod_baile");
                    else
                        out.println("<h2>The category doesn't have dances</h2>");

                    rs.close();
                    st.close();
                }

                st = con.createStatement();
                //Comprobamos si el juez juzga esta categoría
                rs = st.executeQuery("SELECT COUNT(*) AS cont FROM juez_categ WHERE cod_categoria = " + lCateg + " AND id_juez = '"+sJuez+"'");
                rs.next();
                if (rs.getInt("cont") == 0)
                {
                    out.println("<h3>The selected judge doesn't judge this category.<h3>");
                    out.println("<a href = 'jueces.jsp'><h3>You should select another judge.<h3></a>");
                    rs.close();
                }
                else
                {
                    rs.close();

                    //Abreviatura del nombre del baile
                    rs = st.executeQuery("SELECT * FROM bailes WHERE codigo = " + iBaile);
                    if (rs.next())
                        {
                        sBaileAbrev = rs.getString("abrev");
                    }
                    rs.close();

                    st = con.createStatement();
                    rs = st.executeQuery("SELECT COUNT(*) FROM dorsales WHERE cod_categoria = " + lCateg + " and fase = " + iFase + " and repesca = " + iRep);
                    rs.next();
                    iNumDorsales = rs.getInt(1);

                    if (iNumDorsales == 0)
                        out.print("<h2>The category doesn't have participants</h2>");
    
      out.write("\n");
      out.write("        <script type=\"text/javascript\">\n");
      out.write("            var iNumDorsales = ");
      out.print(iNumDorsales);
      out.write("\n");
      out.write("        </script>\n");
      out.write("    ");

                    rs.close();
                    rs = st.executeQuery("SELECT descripcion FROM categorias WHERE codigo = " + lCateg );
                    if (rs.next())
                        sCategoria = rs.getString("descripcion");
                    else
                        sCategoria = "Empty";


                    //Comprobamos si tenemos ya todas las posiciones    
                    rs = st.executeQuery("SELECT num_dorsal, '' AS puesto FROM dorsales WHERE cod_categoria = " + lCateg + " and fase = " + iFase + " and repesca = " + iRep + " ORDER BY num_dorsal");
                    rsmd = rs.getMetaData();
                    String fila = null;
                    int cols = rsmd.getColumnCount();
                    int iPosDorsal = 0;
                    String sPosPuesto;
                    int i = 1;
                    if (iFase == 1) // Fase final ********************************************************************************************************************************
                    {

      out.write("\n");
      out.write("        <form name = \"F2\" method = \"POST\" action=\"puntuar.jsp\">\n");

                        while(rs.next()){
        
      out.write("\n");
      out.write("                                <table align=\"center\" bgcolor=\"#d4d4d4\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\">\n");
      out.write("                                    <tr>\n");
      out.write("\n");
      out.write("        ");

                            //Introducimos el dorsal
                            out.println("<td color= white bgcolor = powderblue align=center width=40 style='font-size: 100px; width:180px; height:110px;'><b>"+String.valueOf(rs.getString("num_dorsal")+"</b></td>"));
        
      out.write("\n");
      out.write("                                    <td id=\"puesto_tabla");
      out.print(iPosDorsal);
      out.write("\" color= white bgcolor = white align=center  width=\"20\">\n");
      out.write("                                    <input type=\"button\" name=\"puesto");
      out.print(iPosDorsal);
      out.write("\" id=\"");
      out.print(iPosDorsal);
      out.write("\" onclick='DorsalNoPresente(this);' value='");
      out.print(rs.getString("puesto"));
      out.write("' style='BORDER: rgb(128,128,128) 0px solid; BACKGROUND-COLOR: rgb(255,255,255); font-size: 100px;  width:100px; height:110px;'\">\n");
      out.write("                                    </td>\n");
      out.write("                                        <td>\n");
      out.write("                                            <font size = 2>\n");
      out.write("                                            <table align=\"center\" bgcolor=\"#d4d4d4\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" height= 20 width=\"200\">\n");
      out.write("                                                <tr>\n");
      out.write("        ");

                            for (i=1; i<=9; i++)
                            {
                                if (i == 6)
                                    out.print("</tr><tr>");

                               if (i <= iNumDorsales)
                                    out.println("<td><input type = 'button' name ='p"+iPosDorsal+"_"+i+"' id ='"+iPosDorsal+"_"+i+"' value = '"+i+"' ondblclick='pasa(this);' onclick='pasa(this);' align=center width=40 style='BORDER: rgb(128,128,128) 1px solid; BACKGROUND-COLOR: rgb(255,255,255); height:70px; width:90px; font-size: 60px;'></td>");
                               else if (i == iNumDorsales+1)
                                    out.println("<td><input type = 'button' name ='c"+iPosDorsal+"' id ='"+iPosDorsal+"' value = 'C' onclick='cambio(this,"+i+",9);' align=center width=40 style='BORDER: rgb(128,128,128) 1px solid; BACKGROUND-COLOR: yellowgreen; height:70px; width:90px; font-size: 60px;'></td>");

                            }
                            iPosDorsal++;
                            out.println("</tr>");
        
      out.write("\n");
      out.write("                                            </tr>\n");
      out.write("                                        </table>\n");
      out.write("                                    </font>\n");
      out.write("                                </td>\n");
      out.write("                            </tr>\n");
      out.write("        ");

                      } //WHILE

      out.write("\n");
      out.write("        </form>\n");

                }
                else // Fases eliminatorias **********************************************************************************************
                {
                        iMarcas = iFase*3;
        
      out.write("\n");
      out.write("                                <table align=\"center\" bgcolor=\"#d4d4d4\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n");
      out.write("                                    <tr>\n");
      out.write("\n");
      out.write("        ");

                        String sNumDorsal  = "";
                        while(rs.next()){
                            sNumDorsal = String.valueOf(rs.getString("num_dorsal"));
                            //Introducimos el dorsal
                            out.println("<td id ='celda"+sNumDorsal+"' align=center border=0>");
                            out.println("<input type = 'button' name ='"+sNumDorsal+"' id ='"+iPosDorsal+"' value = '"+sNumDorsal+"' onclick='pasaElim(this,1);' align=center width=45 style='BORDER: rgb(128,128,128) 1px solid; BACKGROUND-COLOR: white; font-size: 100px; height:200px;'>");
                            out.println("</td>");
                            iPosDorsal++;
                            if (iPosDorsal % 6 == 0)
                                out.println("</tr><tr>");
                      } //WHILE
                }
    
      out.write("\n");
      out.write("                        <tr><td colspan=6>\n");
      out.write("        <form name = \"F1\" method = \"POST\" action=\"puntuar.jsp\">\n");
      out.write("    ");


                rs.close();
                rs = st.executeQuery("SELECT * FROM dorsales WHERE cod_categoria = " + lCateg + " and fase = " + iFase + " and repesca = " + iRep + " ORDER BY num_dorsal");
                i = 0;
                while(rs.next())
                {
                    String sNumDorsal = rs.getString("num_dorsal");
                    out.println("<input type='HIDDEN' name='dorsal"+i+"'  id='dorsal"+i+"' value="+sNumDorsal+">");
                    if (iFase == 1)
                        out.println("<input type='HIDDEN' name='pos"+i+"' id='pos"+i+"' value=0>");
                    else
                        out.println("<input type='HIDDEN' name='pos"+i+"' id='pos"+sNumDorsal+"' value=0>");
                    i++;
                }
                out.println("<input type='HIDDEN' id='num_dorsales' name='num_dorsales' value="+iNumDorsales+">");
    
      out.write("\n");
      out.write("        <script type=\"text/javascript\">\n");
      out.write("            var iMarcas = ");
      out.print(iMarcas);
      out.write(";\n");
      out.write("        </script>\n");
      out.write("    <input type=\"HIDDEN\" name=\"juez\" value=\"");
      out.print(sJuez);
      out.write("\">    \n");
      out.write("    <input type=\"HIDDEN\" name=\"comp\" value=\"");
      out.print(lComp);
      out.write("\">    \n");
      out.write("    <input type=\"HIDDEN\" name=\"categ\" value=\"");
      out.print(lCateg);
      out.write("\">    \n");
      out.write("    <input type=\"HIDDEN\" name=\"fase\" value=\"");
      out.print(iFase);
      out.write("\">    \n");
      out.write("    <input type=\"HIDDEN\" name=\"baile\" value=\"");
      out.print(iBaile);
      out.write("\">    \n");
      out.write("    <input type=\"HIDDEN\" name=\"rep\" value=\"");
      out.print(iRep);
      out.write("\">    \n");
      out.write("    <input type=\"HIDDEN\" name=\"id_pda\" value=\"");
      out.print(iID_PDA);
      out.write("\">\n");
      out.write("    <input type=\"HIDDEN\" name=\"op\" value=\"");
      out.print(iOp);
      out.write("\">\n");
      out.write("    ");

        if (iFase == 1)
            out.println("<input type='button' name='Send' value='Ok' onclick='Enviar();' style='font-size: 100px; width:200px;'>");
        else
            out.println("<input type='button' name='Send' value='Ok' onclick='EnviarElim();' style='font-size: 100px; width:200px;'>");
    
      out.write("\n");
      out.write("\n");
      out.write("    ");

        if (iFase > 1)
            out.println("<input type='button' name='Dorsales' value='"+iMarcas+"'  style='font-size: 100px;'>");
    
      out.write("\n");
      out.write("    <font style='font-size: 60px;'>");
      out.print(sJuez);
      out.write('.');
      out.print(sBaileAbrev);
      out.write(' ');
      out.write('-');
      out.write(' ');
      out.print(sCategoria.substring(0, 10) );
      out.write("</font>\n");
      out.write("   <input type=\"button\" name=\"R\" value=\"R\" onclick='Recargar();' style='font-size: 100px;'> \n");
      out.write("   <b></b></form>\n");
      out.write("    </td></tr>\n");
      out.write("    </table>\n");

            con.close();
                } //else de categoria juzgada por el juez
            } catch (SQLException ex) {
                out.println(ex.toString());
            }   
        
      out.write("\n");
      out.write("    </body>\n");
      out.write("</html>\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
